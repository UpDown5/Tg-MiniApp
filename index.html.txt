<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Casino Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* CSS –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–º—ã Telegram */
        :root {
            --bg-color: #f0f0f0;
            --text-color: #000000;
            --secondary-bg-color: #ffffff;
            --button-color: #55acee;
            --button-text-color: #ffffff;
            --hint-color: #999999;
        }

        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        /* –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã Telegram */
        body.tg-theme {
            --bg-color: var(--tg-theme-bg-color);
            --text-color: var(--tg-theme-text-color);
            --secondary-bg-color: var(--tg-theme-secondary-bg-color);
            --button-color: var(--tg-theme-button-color);
            --button-text-color: var(--tg-theme-button-text-color);
            --hint-color: var(--tg-theme-hint-color);
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: var(--secondary-bg-color);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: var(--button-color);
        }

        .balance {
            font-size: 1.2em;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid var(--hint-color);
            border-radius: 8px;
        }

        .controls {
            margin-bottom: 20px;
        }

        .controls input, .controls button {
            padding: 10px;
            margin: 5px;
            border-radius: 6px;
            border: 1px solid var(--hint-color);
        }

        .controls button {
            background-color: var(--button-color);
            color: var(--button-text-color);
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .controls button:hover:not(:disabled) {
            filter: brightness(1.1);
        }
        
        .controls button:disabled {
            background-color: var(--hint-color);
            cursor: not-allowed;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∫–æ–ª–µ—Å–∞ —Ñ–æ—Ä—Ç—É–Ω—ã */
        .wheel {
            width: 250px;
            height: 250px;
            background: conic-gradient(
                #ffcc00 0% 25%, 
                #4CAF50 25% 50%, 
                #f44336 50% 75%, 
                #2196F3 75% 100%
            );
            border-radius: 50%;
            margin: 20px auto;
            border: 10px solid var(--button-color);
            position: relative;
            transition: transform 3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 15px solid var(--text-color);
        }

        .result {
            margin-top: 20px;
            font-size: 1.1em;
            font-weight: bold;
            color: var(--text-color);
        }
    </style>
</head>
<body class="tg-theme">
    <div class="container">
        <h1>–ö–æ–ª–µ—Å–æ –£–¥–∞—á–∏!</h1>
        <div class="balance">
            –í–∞—à –±–∞–ª–∞–Ω—Å: <span id="userBalance">1000</span> (—Ç–µ—Å—Ç)
        </div>

        <div class="controls">
            <input type="number" id="betInput" value="10" min="1" placeholder="–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞">
            <button id="spinButton">–í—Ä–∞—â–∞—Ç—å –ö–æ–ª–µ—Å–æ</button>
        </div>

        <div class="wheel" id="wheel">
            <div class="pointer"></div>
            </div>

        <div class="result" id="gameResult">
            –ù–∞–∂–º–∏—Ç–µ "–í—Ä–∞—â–∞—Ç—å –ö–æ–ª–µ—Å–æ", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.
        </div>
        
        <p style="font-size: 0.8em; color: var(--hint-color);">
            *–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–¥. –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–∞–∑–∏–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ –∏ Provably Fair —Å–∏—Å—Ç–µ–º–∞.
        </p>
    </div>

    <script>
        const WebApp = window.Telegram.WebApp;
        const userBalanceElem = document.getElementById('userBalance');
        const betInput = document.getElementById('betInput');
        const spinButton = document.getElementById('spinButton');
        const wheel = document.getElementById('wheel');
        const gameResult = document.getElementById('gameResult');
        
        let userBalance = 1000;
        let isSpinning = false;
        
        // –°–µ–∫—Ç–æ—Ä—ã –∫–æ–ª–µ—Å–∞: [–ù–∞–∑–≤–∞–Ω–∏–µ, –ú–Ω–æ–∂–∏—Ç–µ–ª—å, –£–≥–æ–ª –≤ –≥—Ä–∞–¥—É—Å–∞—Ö]
        const sectors = [
            ['x2 (–ö—Ä–∞—Å–Ω—ã–π)', 2, 0],
            ['x0.5 (–°–∏–Ω–∏–π)', 0.5, 90],
            ['x0 (–ó–µ–ª–µ–Ω—ã–π)', 0, 180],
            ['x3 (–ñ–µ–ª—Ç—ã–π)', 3, 270]
        ];

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM MINI APP ---
        function initTelegram() {
            if (WebApp.initDataUnsafe) {
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É Telegram
                document.body.classList.add('tg-theme');
                const themeParams = WebApp.themeParams;
                document.documentElement.style.setProperty('--tg-theme-bg-color', themeParams.bg_color);
                document.documentElement.style.setProperty('--tg-theme-text-color', themeParams.text_color);
                document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', themeParams.secondary_bg_color);
                document.documentElement.style.setProperty('--tg-theme-button-color', themeParams.button_color);
                document.documentElement.style.setProperty('--tg-theme-button-text-color', themeParams.button_text_color);
                document.documentElement.style.setProperty('--tg-theme-hint-color', themeParams.hint_color);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
                WebApp.ready();
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º MainButton Telegram –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                WebApp.MainButton.setText('–ü–æ–ø–æ–ª–Ω–∏—Ç—å –ë–∞–ª–∞–Ω—Å');
                WebApp.MainButton.onClick(showAlert);
                WebApp.MainButton.show();

                console.log("Mini App –∑–∞–ø—É—â–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", WebApp.initDataUnsafe.user.id);
            } else {
                gameResult.textContent = "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ Telegram!";
            }
        }
        
        function showAlert() {
            // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ Telegram
            WebApp.showAlert('–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebApp.openInvoice –∏–ª–∏ –¥—Ä—É–≥—É—é –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É.');
        }

        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---

        function spinWheel() {
            if (isSpinning) return;
            
            const bet = parseInt(betInput.value);
            
            if (isNaN(bet) || bet <= 0) {
                WebApp.showPopup({ message: "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É." });
                return;
            }
            if (userBalance < bet) {
                WebApp.showPopup({ message: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!" });
                return;
            }

            // 1. –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É (–í —Ä–µ–∞–ª—å–Ω–æ–º –∫–∞–∑–∏–Ω–æ - –∑–∞–ø—Ä–æ—Å –∫ –ë–≠–ö–ï–ù–î–£)
            userBalance -= bet;
            userBalanceElem.textContent = userBalance;
            spinButton.disabled = true;
            isSpinning = true;
            gameResult.textContent = '–í—Ä–∞—â–∞–µ–º...';

            // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–í —Ä–µ–∞–ª—å–Ω–æ–º –∫–∞–∑–∏–Ω–æ - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å –ë–≠–ö–ï–ù–î–ê —á–µ—Ä–µ–∑ Provably Fair)
            const winningSectorIndex = Math.floor(Math.random() * sectors.length); // 0, 1, 2 –∏–ª–∏ 3
            const winningSector = sectors[winningSectorIndex];
            
            // 3. –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞
            // –£–≥–æ–ª –¥–æ —Å–µ–∫—Ç–æ—Ä–∞ + 3-5 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤ (360 * 3 –¥–æ 360 * 5) + –Ω–µ–±–æ–ª—å—à–æ–π —Å–¥–≤–∏–≥ –¥–ª—è —Ä–µ–∞–ª–∏–∑–º–∞
            const baseRotation = 360 * 4; 
            const sectorAngle = winningSector[2]; 
            // -45, —Ç–∞–∫ –∫–∞–∫ —Å–µ–∫—Ç–æ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0 –≥—Ä–∞–¥—É—Å–æ–≤, –∞ —Å—Ç—Ä–µ–ª–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –≤ —Å–µ—Ä–µ–¥–∏–Ω—É 90-–≥—Ä–∞–¥—É—Å–Ω–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞
            const targetRotation = baseRotation + (360 - sectorAngle) - 45 + (Math.random() * 80 - 40); // –°–ª—É—á–∞–π–Ω—ã–π —Å–¥–≤–∏–≥

            // 4. –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
            wheel.style.transition = 'transform 3s cubic-bezier(0.25, 0.1, 0.25, 1)';
            wheel.style.transform = `rotate(${targetRotation}deg)`;

            // 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                const multiplier = winningSector[1];
                const winAmount = bet * multiplier;
                
                // –ù–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à (–í —Ä–µ–∞–ª—å–Ω–æ–º –∫–∞–∑–∏–Ω–æ - –∑–∞–ø—Ä–æ—Å –∫ –ë–≠–ö–ï–ù–î–£)
                userBalance += winAmount;
                userBalanceElem.textContent = userBalance.toFixed(2);

                let message;
                if (multiplier > 1) {
                    message = `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount.toFixed(2)} (x${multiplier}).`;
                } else if (multiplier === 1) {
                    message = `üëç –ù–∏—á—å—è. –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞.`;
                } else if (multiplier > 0 && multiplier < 1) {
                    message = `üìâ –ù–µ –ø–æ–≤–µ–∑–ª–æ. –í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ ${(bet - winAmount).toFixed(2)}.`;
                } else {
                    message = `üò≠ –ü—Ä–æ–∏–≥—Ä—ã—à! –í—ã–ø–∞–ª 'x0'. –ü–æ—Ç–µ—Ä—è–Ω–æ ${bet}.`;
                }
                
                gameResult.textContent = message;
                spinButton.disabled = false;
                isSpinning = false;
                
                // –°–±—Ä–æ—Å —Å—Ç–∏–ª—è, —á—Ç–æ–±—ã —Å–ª–µ–¥—É—é—â–µ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–ª–æ—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                wheel.style.transition = 'none';
                wheel.style.transform = `rotate(${targetRotation % 360}deg)`;
            }, 3000); // 3 —Å–µ–∫—É–Ω–¥—ã - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
        }

        // –°–æ–±—ã—Ç–∏—è
        spinButton.addEventListener('click', spinWheel);

        // –ó–∞–ø—É—Å–∫
        initTelegram();
    </script>
</body>
</html>